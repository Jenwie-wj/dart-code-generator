# Dart ä»£ç ç”Ÿæˆå™¨ä½¿ç”¨æ–‡æ¡£

## ç®€ä»‹

Dart ä»£ç ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¯ä»¥å°†ç°æœ‰çš„ API æ–‡ä»¶è½¬æ¢ä¸ºè¾…åŠ©ï¼ˆHelperï¼‰æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢ã€‚è¿™ä¸ªå·¥å…·ä¸»è¦ç”¨äºç®€åŒ– API å°è£…å±‚çš„ä»£ç ç¼–å†™å·¥ä½œã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… è‡ªåŠ¨æ‰«æå¹¶è§£ææ‰€æœ‰ `*_api.dart` æ–‡ä»¶
- âœ… ç”Ÿæˆå¯¹åº”çš„ `*_api_helper.dart` è¾…åŠ©æ–‡ä»¶
- âœ… è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼š
  - `GwResXxx` â†’ `ResXxx` (å“åº”æ¨¡å‹)
  - `GwReqXxx` â†’ `ReqXxx` (è¯·æ±‚æ¨¡å‹)
- âœ… ç‰¹æ®Šå¤„ç†ï¼š
  - `Future<NoneObject>` â†’ `Future<void>`
  - `NoneObject` å‚æ•°è‡ªåŠ¨è¿‡æ»¤
- âœ… æ™ºèƒ½æšä¸¾è½¬æ¢ï¼šåªæœ‰ `value` å­—æ®µçš„æ¨¡å‹è‡ªåŠ¨è½¬ä¸º enum
- âœ… é€å­—æ®µç±»å‹è½¬æ¢ï¼Œä¿è¯æ•°æ®æ­£ç¡®æ˜ å°„

## ç¯å¢ƒè¦æ±‚

- Dart SDK >= 3.0.0

## å®‰è£…æ­¥éª¤

### 1. å…‹éš†ä»“åº“

```bash
git clone https://github.com/Jenwie-wj/dart-code-generator.git
cd dart-code-generator
```

### 2. å®‰è£…ä¾èµ–

```bash
dart pub get
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å‘½ä»¤

```bash
dart run bin/dart_code_generator.dart -s <æºæ–‡ä»¶å¤¹è·¯å¾„> -o <è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„>
```

### å‘½ä»¤å‚æ•°è¯´æ˜

| å‚æ•° | ç®€å†™ | è¯´æ˜ | å¿…å¡« |
|------|------|------|------|
| `--source` | `-s` | æºä»£ç æ–‡ä»¶å¤¹è·¯å¾„ | âœ… æ˜¯ |
| `--output` | `-o` | è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„ | âœ… æ˜¯ |
| `--help` | `-h` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | âŒ å¦ |

### æºæ–‡ä»¶å¤¹ç»“æ„è¦æ±‚

ä½ çš„æºæ–‡ä»¶å¤¹å¿…é¡»åŒ…å«ä»¥ä¸‹ç»“æ„ï¼š

```
æºæ–‡ä»¶å¤¹/
â”œâ”€â”€ api/              # API æ–‡ä»¶å¤¹ï¼ˆå¿…éœ€ï¼‰
â”‚   â”œâ”€â”€ user_api.dart
â”‚   â”œâ”€â”€ product_api.dart
â”‚   â””â”€â”€ ...
â””â”€â”€ model/            # æ¨¡å‹æ–‡ä»¶å¤¹ï¼ˆå¿…éœ€ï¼‰
    â”œâ”€â”€ user_models.dart
    â”œâ”€â”€ product_models.dart
    â””â”€â”€ ...
```

## å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æºæ–‡ä»¶

#### 1. åˆ›å»º API æ–‡ä»¶ (api/user_api.dart)

```dart
class UserApi {
  /// è·å–ç”¨æˆ·ä¿¡æ¯
  Future<GwResUserInfo> getUserInfo(String token, GwReqGetUser body) async {
    // ä½ çš„ API å®ç°ä»£ç 
    return GwResUserInfo(name: 'å¼ ä¸‰', age: 25);
  }
  
  /// ç”¨æˆ·ç™»å½•
  Future<GwResLoginResult> login(GwReqLogin body) async {
    // ä½ çš„ API å®ç°ä»£ç 
    return GwResLoginResult(token: 'abc123', userId: 1001);
  }
  
  /// ç”¨æˆ·ç™»å‡ºï¼ˆæ— è¿”å›å€¼ï¼‰
  Future<NoneObject> logout(String token) async {
    // ä½ çš„ API å®ç°ä»£ç 
    return NoneObject();
  }
}
```

#### 2. åˆ›å»ºæ¨¡å‹æ–‡ä»¶ (model/user_models.dart)

```dart
/// ç”¨æˆ·ä¿¡æ¯å“åº”æ¨¡å‹
class GwResUserInfo {
  const GwResUserInfo({required this.name, required this.age});
  final String name;
  final int age;
}

/// è·å–ç”¨æˆ·è¯·æ±‚æ¨¡å‹
class GwReqGetUser {
  const GwReqGetUser({required this.userId});
  final String userId;
}

/// ç™»å½•ç»“æœå“åº”æ¨¡å‹
class GwResLoginResult {
  const GwResLoginResult({required this.token, required this.userId});
  final String token;
  final int userId;
}

/// ç™»å½•è¯·æ±‚æ¨¡å‹
class GwReqLogin {
  const GwReqLogin({required this.username, required this.password});
  final String username;
  final String password;
}

/// ç©ºå¯¹è±¡ï¼ˆç”¨äºæ— è¿”å›å€¼çš„æ¥å£ï¼‰
class NoneObject {
  const NoneObject();
}
```

#### 3. åˆ›å»ºæšä¸¾ç±»å‹çš„æ¨¡å‹ (model/user_status.dart)

```dart
/// ç”¨æˆ·çŠ¶æ€æ¨¡å‹ï¼ˆå°†è¢«è½¬æ¢ä¸ºæšä¸¾ï¼‰
class GwResUserStatus {
  const GwResUserStatus({required this.value});
  final String value;

  static const active = GwResUserStatus(value: 'ACTIVE');
  static const inactive = GwResUserStatus(value: 'INACTIVE');
  static const suspended = GwResUserStatus(value: 'SUSPENDED');
}
```

### ç¬¬äºŒæ­¥ï¼šè¿è¡Œç”Ÿæˆå™¨

å‡è®¾ä½ çš„æºæ–‡ä»¶å¤¹è·¯å¾„ä¸º `./my_api_source`ï¼Œè¾“å‡ºè·¯å¾„ä¸º `./generated_output`ï¼š

```bash
dart run bin/dart_code_generator.dart -s ./my_api_source -o ./generated_output
```

### ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹ç”Ÿæˆç»“æœ

ç”Ÿæˆå™¨ä¼šåˆ›å»ºä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š

```
generated_output/
â”œâ”€â”€ api/                          # ç”Ÿæˆçš„è¾…åŠ©æ–‡ä»¶
â”‚   â””â”€â”€ user_api_helper.dart
â””â”€â”€ models/                       # ç”Ÿæˆçš„æ¨¡å‹æ–‡ä»¶
    â”œâ”€â”€ res_user_info.dart
    â”œâ”€â”€ req_get_user.dart
    â”œâ”€â”€ res_login_result.dart
    â”œâ”€â”€ req_login.dart
    â””â”€â”€ res_user_status.dart      # æšä¸¾ç±»å‹
```

#### ç”Ÿæˆçš„è¾…åŠ©æ–‡ä»¶ç¤ºä¾‹ (api/user_api_helper.dart)

```dart
// Generated helper file for user_api.dart
// This file is auto-generated. Do not edit manually.

// NOTE: Update this import path to point to your original API file:
// import 'package:your_package/api/user_api.dart';

import '../models/res_user_info.dart';
import '../models/req_get_user.dart';
import '../models/res_login_result.dart';
import '../models/req_login.dart';

// NOTE: Update these import paths to point to your original model files:
// import 'package:your_package/model/gw_res_user_info.dart';
// import 'package:your_package/model/gw_req_get_user.dart';
// import 'package:your_package/model/gw_res_login_result.dart';
// import 'package:your_package/model/gw_req_login.dart';

abstract class UserApiHelper {
  static Future<ResUserInfo> getUserInfo(String token, ReqGetUser body) async {
    final GwResUserInfo res = await UserApi().getUserInfo(token, GwReqGetUser(userId: body.userId));
    return ResUserInfo(name: res.name, age: res.age);
  }

  static Future<ResLoginResult> login(ReqLogin body) async {
    final GwResLoginResult res = await UserApi().login(GwReqLogin(username: body.username, password: body.password));
    return ResLoginResult(token: res.token, userId: res.userId);
  }

  static Future<void> logout(String token) async {
    await UserApi().logout(token);
  }
}
```

#### ç”Ÿæˆçš„å“åº”æ¨¡å‹ç¤ºä¾‹ (models/res_user_info.dart)

```dart
// Generated model class ResUserInfo
class ResUserInfo {
  const ResUserInfo({required this.name, required this.age});

  final String name;
  final int age;
}
```

#### ç”Ÿæˆçš„è¯·æ±‚æ¨¡å‹ç¤ºä¾‹ (models/req_get_user.dart)

```dart
// Generated model class ReqGetUser
class ReqGetUser {
  const ReqGetUser({required this.userId});

  final String userId;
}
```

#### ç”Ÿæˆçš„æšä¸¾ç±»å‹ç¤ºä¾‹ (models/res_user_status.dart)

```dart
// Generated enum ResUserStatus
enum ResUserStatus {
  active,
  inactive,
  suspended
}
```

### ç¬¬å››æ­¥ï¼šæ›´æ–°å¯¼å…¥è·¯å¾„

ç”Ÿæˆçš„æ–‡ä»¶ä¸­åŒ…å« TODO æ³¨é‡Šï¼Œæç¤ºä½ éœ€è¦æ›´æ–°å¯¼å…¥è·¯å¾„ï¼š

```dart
// NOTE: Update this import path to point to your original API file:
// import 'package:your_package/api/user_api.dart';
```

å°†è¿™äº›æ³¨é‡Šå–æ¶ˆæ³¨é‡Šï¼Œå¹¶ä¿®æ”¹ä¸ºä½ é¡¹ç›®å®é™…çš„å¯¼å…¥è·¯å¾„ã€‚

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šAPI å°è£…å±‚ç”Ÿæˆ

å¦‚æœä½ æœ‰ä¸€ä¸ªåº•å±‚çš„ API å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ `GwRes*` å’Œ `GwReq*` æ¨¡å‹ï¼Œç°åœ¨æƒ³è¦ç”Ÿæˆä¸€ä¸ªå¹²å‡€çš„ä¸Šå±‚å°è£…ï¼š

```bash
dart run bin/dart_code_generator.dart \
  -s ./lib/internal/api \
  -o ./lib/public/api
```

### åœºæ™¯ 2ï¼šAPI ç‰ˆæœ¬è¿ç§»

ä» v1 API è¿ç§»åˆ° v2 APIï¼š

```bash
dart run bin/dart_code_generator.dart \
  -s ./lib/api/v1 \
  -o ./lib/api/v2
```

### åœºæ™¯ 3ï¼šç”Ÿæˆæµ‹è¯•è¾…åŠ©æ–‡ä»¶

ä»ç”Ÿäº§ API ç”Ÿæˆæµ‹è¯•è¾…åŠ©æ–‡ä»¶ï¼š

```bash
dart run bin/dart_code_generator.dart \
  -s ./lib/api \
  -o ./test/helpers
```

## ç±»å‹è½¬æ¢è§„åˆ™

| åŸå§‹ç±»å‹ | ç”Ÿæˆç±»å‹ | è¯´æ˜ |
|---------|---------|------|
| `GwResUserInfo` | `ResUserInfo` | å“åº”æ¨¡å‹ |
| `GwReqLogin` | `ReqLogin` | è¯·æ±‚æ¨¡å‹ |
| `Future<GwResXxx>` | `Future<ResXxx>` | å¼‚æ­¥å“åº” |
| `Future<NoneObject>` | `Future<void>` | æ— è¿”å›å€¼ |
| `NoneObject` å‚æ•° | ï¼ˆç§»é™¤ï¼‰ | å‚æ•°è¢«è¿‡æ»¤ |
| åªæœ‰ value å­—æ®µçš„æ¨¡å‹ | æšä¸¾ç±»å‹ | è‡ªåŠ¨æ£€æµ‹å¹¶è½¬æ¢ |

## å¸¸è§é—®é¢˜

### Q1: æç¤º "API directory not found" é”™è¯¯

**ç­”ï¼š** ç¡®ä¿ä½ çš„æºæ–‡ä»¶å¤¹åŒ…å« `api/` å­æ–‡ä»¶å¤¹ã€‚

```bash
# æ­£ç¡®çš„ç»“æ„
source_folder/
â”œâ”€â”€ api/          # â† å¿…é¡»å­˜åœ¨
â””â”€â”€ model/        # â† å¿…é¡»å­˜åœ¨
```

### Q2: æç¤º "Model directory not found" é”™è¯¯

**ç­”ï¼š** ç¡®ä¿ä½ çš„æºæ–‡ä»¶å¤¹åŒ…å« `model/` å­æ–‡ä»¶å¤¹ã€‚

### Q3: ç”Ÿæˆçš„æ–‡ä»¶æ— æ³•ç¼–è¯‘

**ç­”ï¼š** éœ€è¦æ›´æ–°ç”Ÿæˆæ–‡ä»¶ä¸­çš„å¯¼å…¥è·¯å¾„ã€‚æŸ¥æ‰¾æ–‡ä»¶ä¸­çš„ TODO æ³¨é‡Šå¹¶æ›´æ–°ã€‚

### Q4: ç±»å‹è½¬æ¢ä¸æ­£ç¡®

**ç­”ï¼š** ç¡®ä¿æ‰€æœ‰å¼•ç”¨çš„æ¨¡å‹éƒ½å­˜åœ¨äº `model/` æ–‡ä»¶å¤¹ä¸­ã€‚

### Q5: å¦‚ä½•é‡æ–°ç”Ÿæˆæ–‡ä»¶ï¼Ÿ

**ç­”ï¼š** ç›´æ¥é‡æ–°è¿è¡Œå‘½ä»¤å³å¯ï¼Œç”Ÿæˆå™¨ä¼šå…ˆåˆ é™¤æ—§çš„è¾“å‡ºæ–‡ä»¶å¤¹ï¼Œç„¶åé‡æ–°ç”Ÿæˆã€‚

## å¿«é€Ÿæµ‹è¯•

é¡¹ç›®ä¸­åŒ…å«äº†æµ‹è¯•æ•°æ®ï¼Œä½ å¯ä»¥ç«‹å³æµ‹è¯•ï¼š

```bash
# ä½¿ç”¨é¡¹ç›®è‡ªå¸¦çš„æµ‹è¯•æ•°æ®
dart run bin/dart_code_generator.dart -s ./test_input -o ./test_output

# æŸ¥çœ‹ç”Ÿæˆç»“æœ
ls -R test_output/
```

## é¡¹ç›®ç»“æ„è¯´æ˜

```
dart-code-generator/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ dart_code_generator.dart      # CLI å…¥å£
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ dart_code_generator.dart      # ä¸»åº“æ–‡ä»¶
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ code_generator.dart       # ä»£ç ç”Ÿæˆåè°ƒå™¨
â”‚       â”œâ”€â”€ api_parser.dart           # API æ–‡ä»¶è§£æå™¨
â”‚       â”œâ”€â”€ model_parser.dart         # æ¨¡å‹æ–‡ä»¶è§£æå™¨
â”‚       â”œâ”€â”€ helper_generator.dart     # è¾…åŠ©æ–‡ä»¶ç”Ÿæˆå™¨
â”‚       â””â”€â”€ model_generator.dart      # æ¨¡å‹æ–‡ä»¶ç”Ÿæˆå™¨
â”œâ”€â”€ test_input/                       # æµ‹è¯•è¾“å…¥ç¤ºä¾‹
â”œâ”€â”€ README.md                         # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ ä½¿ç”¨æ–‡æ¡£.md                       # æœ¬æ–‡æ¡£
â””â”€â”€ pubspec.yaml                      # åŒ…é…ç½®
```

## æŠ€æœ¯ç‰¹ç‚¹

1. **AST è§£æ**ï¼šä½¿ç”¨ Dart analyzer è¿›è¡Œç²¾ç¡®çš„ä»£ç è§£æï¼Œè€Œä¸æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åŒ¹é…
2. **ä¸¤é˜¶æ®µå¤„ç†**ï¼šå…ˆè§£ææ‰€æœ‰æ¨¡å‹å»ºç«‹ç±»å‹æ³¨å†Œè¡¨ï¼Œå†å¤„ç† API æ–‡ä»¶
3. **é€å­—æ®µè½¬æ¢**ï¼šç”Ÿæˆçš„è½¬æ¢ä»£ç é€å­—æ®µæ˜ å°„ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
4. **æ™ºèƒ½æšä¸¾æ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ«åº”è¯¥è½¬æ¢ä¸ºæšä¸¾çš„æ¨¡å‹ç±»

## æ³¨æ„äº‹é¡¹

1. **å¯¼å…¥è·¯å¾„**ï¼šç”Ÿæˆçš„æ–‡ä»¶åŒ…å« TODO æ³¨é‡Šï¼Œéœ€è¦æ‰‹åŠ¨æ›´æ–°å¯¼å…¥è·¯å¾„
2. **æšä¸¾è½¬æ¢**ï¼šæ”¯æŒåŸºæœ¬çš„æšä¸¾ç”Ÿæˆï¼Œå¤æ‚çš„æšä¸¾åˆ°ç±»çš„è½¬æ¢æš‚ä¸æ”¯æŒ
3. **æ³›å‹ç±»å‹**ï¼šå¤„ç†å¸¸è§çš„æ³›å‹ç±»å‹ï¼Œéå¸¸å¤æ‚çš„åµŒå¥—æ³›å‹å¯èƒ½éœ€è¦æ‰‹åŠ¨æ£€æŸ¥
4. **æ„é€ å‡½æ•°**ï¼šå‡å®šä½¿ç”¨æ ‡å‡†çš„ Dart æ„é€ å‡½æ•°æ¨¡å¼

## è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹ `test_input/` æ–‡ä»¶å¤¹ä¸­çš„ç¤ºä¾‹æ–‡ä»¶
2. è¿è¡Œ `./generate_examples.sh` ç”Ÿæˆç¤ºä¾‹è¾“å‡º
3. é˜…è¯»å…¶ä»–æ–‡æ¡£ï¼š
   - `README.md` - è‹±æ–‡è¯´æ˜
   - `QUICKSTART.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
   - `USAGE.md` - è¯¦ç»†ä½¿ç”¨è¯´æ˜
   - `PROJECT_STRUCTURE.md` - æŠ€æœ¯æ¶æ„æ–‡æ¡£

## æç¤ºå’ŒæŠ€å·§

1. **ä»å°åšèµ·**ï¼šå…ˆç”¨ä¸€ä¸ªç®€å•çš„ API æ–‡ä»¶æµ‹è¯•
2. **æ£€æŸ¥è¾“å‡º**ï¼šä½¿ç”¨å‰åŠ¡å¿…æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
3. **æ›´æ–°å¯¼å…¥**ï¼šä¸è¦å¿˜è®°æ›´æ–° TODO å¯¼å…¥æ³¨é‡Š
4. **ç‰ˆæœ¬æ§åˆ¶**ï¼šå†³å®šæ˜¯å¦å°†ç”Ÿæˆçš„æ–‡ä»¶åŠ å…¥ç‰ˆæœ¬æ§åˆ¶æˆ–æ·»åŠ åˆ° `.gitignore`
5. **è¿­ä»£ä½¿ç”¨**ï¼šAPI å˜åŒ–æ—¶é‡æ–°è¿è¡Œç”Ÿæˆå™¨

## ç¤ºä¾‹å‘½ä»¤æ€»ç»“

```bash
# æŸ¥çœ‹å¸®åŠ©
dart run bin/dart_code_generator.dart --help

# åŸºæœ¬ä½¿ç”¨
dart run bin/dart_code_generator.dart -s ./source -o ./output

# ä½¿ç”¨æµ‹è¯•æ•°æ®
dart run bin/dart_code_generator.dart -s ./test_input -o ./test_output

# ç”Ÿæˆç¤ºä¾‹è¾“å‡º
./generate_examples.sh
```

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æ Issue æˆ– Pull Requestã€‚
